<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Izikgram</title>
    <link th:href="@{/images/Logo.png}" rel="shortcut icon" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" th:href="@{/css/default.css}">
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
<div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-lg relative">
    <div class="pt-20"><header th:replace="~{header :: header} " class="pt-4"></header></div>

    <!-- í™˜ì˜ ë©”ì‹œì§€ -->
    <div class="mb-6 flex items-center justify-between">
        <div>
            ì•ˆë…•í•˜ì„¸ìš”, <span th:text="${#authentication.getPrincipal().getUser().getNickname()}"></span>ë‹˜!
            <p class="text-sm text-gray-600">ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</p>
        </div>
        <button onclick="finishchat()" class="p-3 text-sm text-left bg-[#00a3ed] rounded-full hover:bg-[#0091c7] transition-colors duration-200">
            ëŒ€í™”ì¢…ë£Œ
        </button>
    </div>



    <!-- ë²„íŠ¼ ê·¸ë¦¬ë“œ -->
    <div class="grid grid-cols-2 gap-3 mb-4">
        <button onclick="stresschat()" class="p-3 text-sm text-left bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200">
            ì˜¤ëŠ˜ì˜ í‡´ì‚¬ ìˆ˜ì¹˜
        </button>

        <button onclick="feelchat()" class="p-3 text-sm text-left bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200">
            í•˜ì†Œì—°í•˜ê¸°
        </button>

        <button onclick="paydaychat()" class="p-3 text-sm text-left bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200">
            ì›”ê¸‰ì¼ê¹Œì§€ ë‚¨ì€ ì¼ìˆ˜
        </button>

        <button onclick="endtimechat()" class="p-3 text-sm text-left bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200">
            ë‚¨ì€ í‡´ê·¼ì‹œê°„
        </button>

        <button onclick="handleJobPostings()" class="p-3 text-sm text-left bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200">
            ë§ì¶¤í˜• ì´ì§ ê³µê³  ë³´ê¸°
        </button>
    </div>

    <!-- ë©”ì‹œì§€ ì˜ì—­ -->
    <div id="messages" class="max-h-96 overflow-y-auto mb-4 p-4 border border-gray-300 rounded-lg space-y-3">
        <!-- ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
    </div>

    <!-- ì‚¬ìš©ì ì…ë ¥ ì˜ì—­ -->
    <div id="inputSection" class="hidden flex">
        <input id="userInput" type="text" class="w-full p-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeydown="checkEnter(event)">
        <button onclick="handleGeneralChat()" class="bg-blue-500 text-white p-2 rounded-r-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400">ì „ì†¡</button>
    </div>
</div>
<!-- Thymeleafë¡œ ì‚¬ìš©ì ì›”ê¸‰ë‚  ì£¼ì… -->
<div id="paydayData" th:data-payday="${#authentication.getPrincipal().getUser().getPayday()}"></div>
<div id="endtimeData" th:data-endtime="${#authentication.getPrincipal().getUser().getEnd_time()}"></div>
<div id="stressData" th:data-stress="${@mainService.getStressNum(#authentication.principal.user.member_id)}"></div>

<script>
    // ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    function appendUserMessage(text) {
        const messagesDiv = document.getElementById('messages');
        const userMessageDiv = document.createElement('div');
        userMessageDiv.classList.add('text-right', 'text-sm', 'bg-blue-100', 'rounded-lg', 'p-2');
        userMessageDiv.innerText = text;
        messagesDiv.appendChild(userMessageDiv);
        return messagesDiv;
    }

    function appendBotMessage(text) {
        const messagesDiv = document.getElementById('messages');
        const botMessageDiv = document.createElement('div');
        botMessageDiv.classList.add('text-left', 'text-sm', 'bg-gray-100', 'rounded-lg', 'p-2');
        botMessageDiv.innerText = text;
        messagesDiv.appendChild(botMessageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function showLoading(message = 'ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...') {
        const messagesDiv = document.getElementById('messages');
        const loadingDiv = document.createElement('div');
        loadingDiv.id = 'loadingMessage';
        loadingDiv.classList.add('text-center', 'text-sm', 'text-gray-500');
        loadingDiv.innerText = message;
        messagesDiv.appendChild(loadingDiv);
    }

    function removeLoading() {
        const loadingMessage = document.getElementById('loadingMessage');
        if (loadingMessage) loadingMessage.remove();
    }

    // ê° ë²„íŠ¼ë³„ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë“¤
    async function paydaychat() {
        appendUserMessage("ì›”ê¸‰ê¹Œì§€ ë‚¨ì€ ì¼ìˆ˜?");
        showLoading("ê¸‰ì—¬ì¼ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...");

        // Thymeleafë¥¼ í†µí•´ HTMLì— ì£¼ì…ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const paydayStr = document.getElementById('paydayData').getAttribute('data-payday');

        if (!paydayStr) {
            removeLoading();
            appendBotMessage("ê¸‰ì—¬ì¼ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        // ì˜¤ëŠ˜ ë‚ ì§œ
        const today = new Date();
        const payday = new Date(today.getFullYear(), today.getMonth(), parseInt(paydayStr));

        // ì›”ê¸‰ë‚ ì´ ì´ë¯¸ ì§€ë‚¬ìœ¼ë©´ ë‹¤ìŒ ë‹¬ë¡œ ë³€ê²½
        if (payday < today) {
            payday.setMonth(payday.getMonth() + 1);
        }

        // D-DAY ê³„ì‚°
        setTimeout(() => {
            const timeDiff = payday - today;
            const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

            // ë¡œë”© ë©”ì‹œì§€ ì œê±° í›„ ì±—ë´‡ ì‘ë‹µ ì¶”ê°€
            removeLoading();
            appendBotMessage(`ì›”ê¸‰ì¼ê¹Œì§€ ${daysLeft}ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`);
        }, 500);
    }

    async function endtimechat() {
        appendUserMessage("ë‚¨ì€ í‡´ê·¼ì‹œê°„");
        showLoading("í‡´ê·¼ì‹œê°„ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...");

        setTimeout(() => {
            const endtimeElement = document.getElementById('endtimeData');
            const endtimeStr = endtimeElement.getAttribute('data-endtime'); // "2025-02-21 18:00" ê°™ì€ í˜•íƒœ

            if (!endtimeStr) {
                appendBotMessage("í‡´ê·¼ì‹œê°„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            const today = new Date();
            const [endHour, endMinute] = endtimeStr.split(":").map(Number);
            const endtime = new Date(today.getFullYear(), today.getMonth(), today.getDate(), endHour, endMinute);

            const diffTime = endtime - today;

            if (diffTime <= 0) {
                removeLoading();
                appendBotMessage("í‡´ê·¼ ì‹œê°„ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤!");
                return;
            }

            const diffHours = Math.floor(diffTime / (1000 * 60 * 60)); // ë‚¨ì€ ì‹œê°„
            const diffMinutes = Math.floor((diffTime % (1000 * 60 * 60)) / (1000 * 60)); // ë‚¨ì€ ë¶„

            removeLoading();
            appendBotMessage(`í‡´ê·¼ê¹Œì§€ ${diffHours}ì‹œê°„ ${diffMinutes}ë¶„ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`);
        }, 500); // 1ì´ˆ ëŒ€ê¸° í›„ ì²˜ë¦¬
    }

    async function stresschat() {
        const messagesDiv = appendUserMessage("ì˜¤ëŠ˜ì˜ í‡´ì‚¬ ìˆ˜ì¹˜");
        showLoading('í‡´ì‚¬ í†µê³„ë¥¼ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤...');

        // 500ms í›„ì— stress ìˆ˜ì¹˜ ê°€ì ¸ì˜¤ê¸°
        setTimeout(() => {
            const stressStr = document.getElementById('stressData').getAttribute('data-stress');

            console.log(stressStr);  // ìŠ¤íŠ¸ë ˆìŠ¤ ê°’ì´ ì˜ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì½˜ì†”ì— ì¶œë ¥

            if (!stressStr) {
                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í•´ë‹¹ ë©”ì‹œì§€ ì¶œë ¥
                removeLoading();
                appendBotMessage("í‡´ì‚¬ ì§€ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // ë°ì´í„°ê°€ ìˆìœ¼ë©´ í‡´ì‚¬ ì§€ìˆ˜ ì¶œë ¥
            removeLoading();
            appendBotMessage(`ì˜¤ëŠ˜ì˜ í‡´ì‚¬ì§€ìˆ˜ëŠ” ${stressStr}% ì…ë‹ˆë‹¤.`);
        }, 500);
    }



    function feelchat() {
        // ì…ë ¥ì°½ í‘œì‹œ
        document.getElementById('inputSection').classList.remove('hidden');

        // í•˜ì†Œì—°í•˜ê¸° ë¬¸ì¥ì„ í™”ë©´ì— ì¶”ê°€
        appendUserMessage("í•˜ì†Œì—°í•˜ê¸°");
        appendBotMessage(`ì•ˆë…•í•˜ì„¸ìš”. ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë– ì…¨ë‚˜ìš”? ë§ì”€í•´ì£¼ì‹  ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.`);

        handleGeneralChat();
    }



        let conversationHistory = [];

    // ëŒ€í™” ì¢…ë£Œ ì²˜ë¦¬ í•¨ìˆ˜
    function finishchat() {
        // ëŒ€í™” ì¢…ë£Œ ë©”ì‹œì§€ ì¶”ê°€
        const message = "ëŒ€í™”ì¢…ë£Œ";

        // ëŒ€í™” ì¢…ë£Œ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— ì¶”ê°€
        appendUserMessage(message);

        // ì„ì‹œë¡œ userInput ê°’ì„ ì„¤ì •í•˜ê³  handleGeneralChat í˜¸ì¶œ
        const userInput = document.getElementById('userInput');
        const originalValue = userInput.value; // ê¸°ì¡´ ê°’ ì €ì¥

        userInput.value = message; // userInput ê°’ì„ "ëŒ€í™”ì¢…ë£Œ"ë¡œ ë³€ê²½

        // handleGeneralChat í˜¸ì¶œ (ì´ë¡œì¨ "ëŒ€í™”ì¢…ë£Œ" ë©”ì‹œì§€ê°€ APIë¡œ ì „ì†¡ë¨)
        handleGeneralChat(true); // true íŒŒë¼ë¯¸í„°ë¡œ ëŒ€í™”ì¢…ë£Œ ëª¨ë“œ í‘œì‹œ

        // ì›ë˜ ê°’ìœ¼ë¡œ ë³µì› (í•„ìš”í•œ ê²½ìš°)
        userInput.value = originalValue;
    }

    // handleGeneralChat í•¨ìˆ˜ ìˆ˜ì •
    async function handleGeneralChat(isEndingChat = false) {
        const userInput = document.getElementById('userInput');
        const message = isEndingChat ? "ëŒ€í™”ì¢…ë£Œ" : userInput.value.trim();

        // ë©”ì‹œì§€ê°€ ë¹„ì–´ìˆê³  ëŒ€í™”ì¢…ë£Œê°€ ì•„ë‹ˆë©´ í•¨ìˆ˜ ì¢…ë£Œ
        if (!message && !isEndingChat) return;

        if (!isEndingChat) {
            appendUserMessage(message);
        }

        showLoading('ë‹µë³€ì„ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤...');

        // ì‹œìŠ¤í…œ ë©”ì‹œì§€ (ì´ˆê¸° ì„¤ì • ë©”ì‹œì§€) - ëŒ€í™” ì‹œì‘ì‹œ í•œ ë²ˆë§Œ ì„¤ì •ë¨
        if (conversationHistory.length === 0) {
            conversationHistory.push({
                "role": "system",
                "content": "ì—­í•  ì„¤ì •: ì €ëŠ” ì§ì¥ì¸ë“¤ì˜ ê°ì •ì„ ì „ë¬¸ì ìœ¼ë¡œ ì¼€ì–´í•˜ëŠ” AI ìƒë‹´ì‚¬ë¡œì„œ, ì‚¬ìš©ìì˜ ê°ì •ì„ ê¹Šì´ ì´í•´í•˜ê³  ê³µê°í•˜ëŠ” ìƒë‹´ì„ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤. ì €ëŠ” í•­ìƒ ì¹œì ˆí•˜ê³  ë”°ëœ»í•œ ì–´ì¡°ë¡œ ëŒ€í™”í•˜ë©°, ì „ë¬¸ì ì´ê³  ì„¸ì‹¬í•˜ê²Œ ì ‘ê·¼í•©ë‹ˆë‹¤.\\n\nê°ì • ë¶„ì„ í”„ë¡œì„¸ìŠ¤: ì‚¬ìš©ìì˜ ëª¨ë“  ëŒ€í™”ë¥¼ ê°ì •ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬, í˜„ì¬ ì‚¬ìš©ìì˜ ê°ì • ìƒíƒœë¥¼ ì •í™•í•˜ê²Œ íŒŒì•…í•©ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ê°ì • ìƒíƒœë¥¼ 0~100 ì‚¬ì´ì˜ í‡´ì‚¬ì§€ìˆ˜ë¡œ í‰ê°€í•©ë‹ˆë‹¤. ì´ í‡´ì‚¬ì§€ìˆ˜ëŠ” ì‚¬ìš©ìê°€ ì§ì¥ì—ì„œ ì–¼ë§ˆë‚˜ í˜ë“¤ì–´í•˜ëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ë©°, ëŒ€í™” ì¢…ë£Œ ì‹œ ì œê³µë©ë‹ˆë‹¤.\\n\nëŒ€í™” ê°€ì´ë“œë¼ì¸: ì‚¬ìš©ìì˜ ê°ì • ìƒíƒœë¥¼ ì„¸ì‹¬í•˜ê²Œ ì‚´í´ë³´ë©°, í•„ìš”í•  ê²½ìš° ì‹¤ì§ˆì ì¸ ì¡°ì–¸ê³¼ ì‹¬ë¦¬ì  ì§€ì§€ë¥¼ ì œê³µí•©ë‹ˆë‹¤.\n ëŒ€í™”ì¢…ë£Œê°€ ë˜ê¸°ì „ê¹Œì§„ ì£¼ê³ ë°›ì€ ë‚´ìš©ì„ ê¸°ì–µí•˜ë©° ëŒ€í™”\n ëŒ€í™”ê°€ ì¢…ë£Œë  ë•Œë§Œ í‡´ì‚¬ì§€ìˆ˜ë¥¼ ì œê³µí•˜ë©°, \"ëŒ€í™”ì¢…ë£Œ\"ë¼ëŠ” ë§ì´ ë‚˜ì˜¤ë©´ ëŒ€í™”ê°€ ì¢…ë£Œë©ë‹ˆë‹¤.\n ëŒ€í™”ì—ì„œëŠ” ê³¼ë„í•˜ê²Œ ê¸ì •ì ì´ê±°ë‚˜ ë¶€ì •ì ì´ì§€ ì•Šê²Œ ê· í˜•ì„ ì¡ì•„ê°€ë©° ëŒ€í™”ë¥¼ ì´ì–´ê°‘ë‹ˆë‹¤.\n ì‚¬ìš©ìì˜ í”„ë¼ì´ë²„ì‹œì™€ ê°ì •ì„ ìµœìš°ì„ ìœ¼ë¡œ ì¡´ì¤‘í•˜ë©°, í•„ìš”í•œ ê²½ìš° ì‹¤ì§ˆì ì¸ ëŒ€ì²˜ ë°©ì•ˆë„ ì œì•ˆ.\\n\ní‡´ì‚¬ì§€ìˆ˜ ê³„ì‚° ë°©ì‹: ëŒ€í™” ì¤‘ì— ì‚¬ìš©ìì˜ ë°œì–¸ì„ ê°ì •ì ìœ¼ë¡œ ë¶„ì„. ë¶€ì •ì ì¸ ë‹¨ì–´ì™€ ê¸ì •ì ì¸ ë‹¨ì–´ì˜ ë¹ˆë„ì— ë”°ë¼ í‡´ì‚¬ì§€ìˆ˜ë¥¼ ê³„ì‚°.\n ê¸ì •ì ì¸ ë‹¨ì–´ê°€ ë§ì´ ì‚¬ìš©ë˜ë©´ í‡´ì‚¬ì§€ìˆ˜ê°€ ë‚®ì•„ì§€ê³ , ë¶€ì •ì ì¸ ë‹¨ì–´ê°€ ë§ì´ ì‚¬ìš©ë˜ë©´ í‡´ì‚¬ì§€ìˆ˜ê°€ ë†’ì•„ì§„ë‹¤.\n ëŒ€í™” ì¢…ë£Œ ì‹œ \"ì˜¤ëŠ˜ì˜ í‡´ì‚¬ì§€ìˆ˜ëŠ” [í‡´ì‚¬ì§€ìˆ˜]ì…ë‹ˆë‹¤"
            });
        }

        // API í˜¸ì¶œì˜ ì¼ê´€ì„±ì„ ìœ„í•´ ì—¬ê¸°ì„œë„ í™•ì¸)
        if (isEndingChat && conversationHistory.length > 0 &&
            conversationHistory[conversationHistory.length - 1].content === "ëŒ€í™”ì¢…ë£Œ") {
            // ì´ë¯¸ ì¶”ê°€ë˜ì–´ ìˆìœ¼ë©´ ë‹¤ì‹œ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
        } else {
            conversationHistory.push({ role: 'user', content: message });
        }

        try {
            const response = await fetch('/chat/feelchat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    messages: conversationHistory  // ì „ì²´ ëŒ€í™” ê¸°ë¡ ì „ì†¡
                })
            });

            const data = await response.json();
            removeLoading();

            // ì±—ë´‡ ì‘ë‹µì„ ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€
            conversationHistory.push({ role: 'assistant', content: data.responseMessage });

            appendBotMessage(data.responseMessage); // ì±—ë´‡ ì‘ë‹µ ë©”ì‹œì§€ ì²˜ë¦¬
        } catch (error) {
            removeLoading();
            appendBotMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ë‹µë³€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }

        // ëŒ€í™”ì¢…ë£Œ ëª¨ë“œê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì…ë ¥ì°½ ì´ˆê¸°í™”
        if (!isEndingChat) {
            userInput.value = '';  // ì…ë ¥ì°½ ì´ˆê¸°í™”
        }
    }



    function formatTimestamp(timestamp) {
        const date = new Date(timestamp * 1000); // Unix timestampë¥¼ ë°€ë¦¬ì´ˆë¡œ ë³€í™˜
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // ë§ì¶¤í˜• ì´ì§ ê³µê³  í•¸ë“¤ëŸ¬
    async function handleJobPostings() {
        appendUserMessage("ë§ì¶¤í˜• ì´ì§ ê³µê³ ");
        showLoading("ë§ì¶¤í˜• ì±„ìš©ê³µê³ ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...");

        try {
            const response = await fetch('/user/analyze/recommend-jobs', {
                method: 'POST'
            });

            const recommendedJobs = await response.json();

            removeLoading();

            if (recommendedJobs.length === 0) {
                appendBotMessage("í˜„ì¬ ë§ì¶¤í˜• ì±„ìš©ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // ë§ì¶¤í˜• ê³µê³  ë©”ì‹œì§€ ìƒì„±
            recommendedJobs.forEach(job => {
                const jobMessage = `ğŸŒŸ ì¶”ì²œ ì±„ìš©ê³µê³ 

ğŸ“ ê¸°ì—…ëª…: ${job.companyName}
ğŸ“‹ ì œëª©: ${job.title}
ğŸ“ ì§€ì—­: ${job.locationName}
ğŸ’¼ ì—…ì¢…: ${job.industryName}
ğŸ‘¥ ê²½ë ¥: ${job.experienceMax === 0 && job.experienceMin === 0 ? 'ì‹ ì…'
                    : (job.experienceMax === job.experienceMin ? `ê²½ë ¥ ${job.experienceMax}ë…„`
                        : `ê²½ë ¥ ${Math.min(job.experienceMax, job.experienceMin)}~${Math.max(job.experienceMax, job.experienceMin)}ë…„`)}
ğŸ“… ë§ˆê°ì¼: ${formatTimestamp(parseFloat(job.expirationTimestamp))}`;

                // HTML ë§í¬ë¥¼ í¬í•¨í•œ ë©”ì‹œì§€ ìƒì„±
                const linkMessage = `${jobMessage}\n\nğŸ‘‰ <a href="${job.url}" target="_blank" style="color: blue; text-decoration: underline;">ìƒì„¸ í˜ì´ì§€ ë°”ë¡œê°€ê¸°</a>`;

                appendBotMessage(linkMessage);
            });

        } catch (error) {
            removeLoading();
            appendBotMessage('ë§ì¶¤í˜• ì±„ìš©ê³µê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            console.error('Error fetching recommended jobs:', error);
        }
    }

    function appendBotMessage(text) {
        const messagesDiv = document.getElementById('messages');
        const botMessageDiv = document.createElement('div');
        botMessageDiv.classList.add('text-left', 'text-sm', 'bg-gray-100', 'rounded-lg', 'p-2');

        // HTMLì„ ì•ˆì „í•˜ê²Œ íŒŒì‹±í•˜ì—¬ ì¶”ê°€
        botMessageDiv.innerHTML = text.replace(/\n/g, '<br>');

        messagesDiv.appendChild(botMessageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // Enter í‚¤ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    function checkEnter(event) {
        if (event.key === 'Enter') {
            handleGeneralChat();
        }
    }
    const stressNum = /*[[${@mainService.getStressNum(#authentication.principal.user.member_id)}]]*/ 0;

</script>
</body>
</html>