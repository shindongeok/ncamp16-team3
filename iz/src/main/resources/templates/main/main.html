<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Izikgram</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/default.css}">
    <!-- timepicki -->
    <link rel="stylesheet" th:href="@{/css/timepicki.css}">
    <script th:src="@{/js/timepicki.js}"></script>
    <script>
        $(document).ready(function(){
            $('#workStartTime').timepicki({
                start_time: ["09", "00", "AM"],
                step_size_minutes: 30,
                disable_keyboard_mobile: true,
                show_meridian: false,
                min_hour_value: 0,
                max_hour_value: 23,
                overflow_minutes: true
            });
            $('#workEndTime').timepicki({
                start_time: ["18", "00"],
                step_size_minutes: 30,
                disable_keyboard_mobile: true,
                show_meridian: false,
                min_hour_value: 0,
                max_hour_value: 23,
                overflow_minutes: true
            });
            $('#lunchTime').timepicki({
                start_time: ["12", "00"],
                step_size_minutes: 30,
                disable_keyboard_mobile: true,
                show_meridian: false,
                min_hour_value: 0,
                max_hour_value: 23,
                overflow_minutes: true
            });
        });
    </script>
    <style type="text/tailwindcss">
        @theme {
            --color-main-sky-highlight: #00a3ed;
            --color-main-sky-basic: #9bdcfd;
            --color-main-red-highlight: #ff5353;
            --color-main-red-basic: #ff9898;
            --color-main-yellow-highlight: #fbc159ff;
            --color-main-yellow-basic: #fdd391;

            /* gray-400*/
            --color-light-text: oklch(0.704 0.04 256.788);
            /* gray-600 */
            --color-basic-text: oklch(0.446 0.043 257.281);
            /* gray-900 */
            --color-bold-text: oklch(0.208 0.042 265.755);
        }
        @media screen and (max-width: 768px) {
            /* ìŠ¤íŠ¸ë ˆìŠ¤ ì„¹ì…˜ ë ˆì´ì•„ì›ƒ ì™„ì „ ì¬êµ¬ì„± */
            .stress-section .flex-row {
                flex-direction: column !important;
                align-items: center !important;
                gap: 1.5rem !important;
            }

            /* SVG ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
            .stress-section .relative {
                width: 100%;
                display: flex;
                justify-content: center;
            }

            /* SVG í¬ê¸° ì¡°ì • */
            .stress-section svg {
                width: 180px !important;
                height: 180px !important;
            }

            /* í…ìŠ¤íŠ¸ ì˜ì—­ ì¡°ì • */
            .stress-section .bg-white {
                max-width: 100% !important;
                width: 100% !important;
                margin-top: 0 !important;
            }

            /* í™”ì‚´í‘œ ìœ„ì¹˜ ì¡°ì • */
            .stress-section .bg-white .absolute {
                display: none; /* ëª¨ë°”ì¼ì—ì„œëŠ” í™”ì‚´í‘œ ìˆ¨ê¹€ */
            }
        }
        @media screen and (max-width: 768px) {
            /* Overview ì„¹ì…˜ì˜ ì¹´ë“œ ë ˆì´ì•„ì›ƒë„ ì„¸ë¡œë¡œ ë³€ê²½ */
            .py-4 .flex-row.flex-grow {
                flex-direction: column !important;
                gap: 1rem !important;
            }

            /* ì¹´ë“œ ë„ˆë¹„ ì¡°ì • */
            .py-4 .flex-row.flex-grow .flex-1 {
                width: 100% !important;
            }
        }
        @media screen and (max-width: 768px) {
            .px-10 {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }
        }
    </style>
</head>
<!-- HTML body ë¶€ë¶„ -->
<body class="font-roboto mobile-container bg-[#f0f0f0]">
<div sec:authorize="isAuthenticated()" class="relative bg-white min-h-screen md:w-[600px] md:mx-auto md:shadow-md w-full">
    <div class="pt-28"><header th:replace="~{header :: header}" class="pt-4"></header></div>
    <footer th:replace="~{footer :: footer}" class="pt-4"></footer>

    <div class="px-10">
        <!-- í˜ì´ì§€ ì œëª© -->
        <div class="text-[1.7rem] font-bold text-[#2C2C2C]">Dashboard</div>

        <!-- ì¸ê¸° ê²Œì‹œê¸€ ì„¹ì…˜ -->
        <div class="py-3 flex items-center gap-3">
            <span class="text-base text-gray-600 flex items-center gap-1">ğŸ”¥ ì¸ê¸°ê²Œì‹œê¸€</span>
            <div class="popular-content-bubble relative h-12 overflow-hidden bg-[#f8f9fa] rounded-3xl flex-1">
                <div th:if="${#lists.isEmpty(@mainService.getPopularBoardList())}"
                     class="text-sm text-gray-600 text-center p-4">
                    ì¸ê¸°ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤
                </div>
                <div class="popular-content-bubble-item absolute w-full h-full flex justify-between items-center opacity-0 translate-y-full animate-slide cursor-pointer"
                     th:unless="${#lists.isEmpty(@mainService.getPopularBoardList())}"
                     th:each="board, iterStat : ${@mainService.getPopularBoardList()}"
                     th:if="${iterStat.index < 3}">
                    <a th:href="@{/board/{board_type}/{board_id}(board_type=${board.board_type}, board_id=${board.board_id})}"
                       class="flex justify-between items-center w-full px-4 no-underline text-inherit">
                            <span class="text-base text-gray-800 flex-1 whitespace-nowrap overflow-hidden text-ellipsis mr-3"
                                  th:text="${board.title}"></span>
                        <span class="text-sm text-gray-600 whitespace-nowrap flex items-center gap-1">
                                ğŸ‘ <span th:text="${board.like_count}"></span>
                            </span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Calendar ì„¹ì…˜ -->
        <div class="py-4">
            <div class="text-2xl font-semibold mb-3">Calendar</div>
            <div class="today-date text-lg mb-4 pl-2.5"></div>
            <div class="bg-[#f8f9fa] rounded-2xl p-4">
                <div class="calendar-grid grid grid-cols-7 gap-2 text-center">
                    <span class="day-label text-lg py-2">M</span>
                    <span class="day-label text-lg py-2">T</span>
                    <span class="day-label text-lg py-2">W</span>
                    <span class="day-label text-lg py-2">T</span>
                    <span class="day-label text-lg py-2">F</span>
                    <span class="day-label text-lg py-2">S</span>
                    <span class="day-label text-lg py-2">S</span>
                </div>
                <div class="calendar-grid grid grid-cols-7 gap-2 text-center mt-2">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„±ë¨ -->
                </div>
            </div>
        </div>

        <!-- Overview ì„¹ì…˜ -->
        <div class="py-4">
            <div class="text-2xl font-semibold mb-3">Overview</div>
            <div class="pt-2.5 flex flex-row flex-grow gap-4">
                <div class="flex-1 p-4 bg-[#f8f9fa] rounded-2xl flex flex-col gap-2">
                    <div class="flex items-center gap-2">
                            <span class="w-8 h-8 bg-[#f0f0f0] rounded-lg flex items-center justify-center text-lg flex-shrink-0">
                                ğŸ’¸
                            </span>
                        <div class="text-lg">ì›”ê¸‰ê¹Œì§€</div>
                    </div>
                    <div class="text-3xl font-semibold text-[#2C2C2C] text-right mr-5" id="payday"></div>
                </div>
                <div class="flex-1 p-4 bg-[#f8f9fa] rounded-2xl flex flex-col gap-2">
                    <div class="flex items-center gap-2">
                            <span class="w-8 h-8 bg-[#f0f0f0] rounded-lg flex items-center justify-center text-lg flex-shrink-0">
                                ğŸ“‰
                            </span>
                        <div class="text-lg">ì´ë²ˆì£¼ í‰ê·  í‡´ì‚¬ì§€ìˆ˜</div>
                    </div>
                    <div class="stress-no-data hidden text-gray-600 text-sm text-center p-4 overview-card">
                        ì•„ì§ ê¸°ë¡ëœ í‡´ì‚¬ì§€ìˆ˜ê°€ ì—†ì–´ìš”
                    </div>
                    <div class="text-3xl font-semibold text-[#ff5353] text-right mr-5" id="weeklyStressNum"></div>
                </div>
            </div>
        </div>
        <!-- ëª¨ë‹¬ -->
        <div class="time-settings-modal fixed inset-0 hidden bg-black/50 z-50 items-center justify-center" id="timeSettingsModal">
            <div class="bg-white rounded-2xl w-[90%] max-w-[320px] px-6 py-6 shadow-lg">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">ì‹œê°„ ì„¤ì •</h3>
                    <button class="close-modal-btn text-3xl text-gray-600 hover:text-gray-800 cursor-pointer">&times;</button>
                </div>
                <div class="space-y-5 mb-6">
                    <div>
                        <label for="workStartTime" class="block mb-2 text-base text-gray-700">ì¶œê·¼ ì‹œê°„</label>
                        <input type="text" id="workStartTime"
                               th:value="${@mainService.getStartTime(#authentication.principal.user.member_id)}"
                               class="w-[90%] p-3 border border-gray-300 rounded-lg text-base cursor-pointer">
                    </div>
                    <div>
                        <label for="lunchTime" class="block mb-2 text-base text-gray-700">ì ì‹¬ ì‹œê°„</label>
                        <input type="text" id="lunchTime"
                               th:value="${@mainService.getLunchTime(#authentication.principal.user.member_id)}"
                               class="w-[90%] p-3 border border-gray-300 rounded-lg text-base cursor-pointer">
                    </div>
                    <div>
                        <label for="workEndTime" class="block mb-2 text-base text-gray-700">í‡´ê·¼ ì‹œê°„</label>
                        <input type="text" id="workEndTime"
                               th:value="${@mainService.getEndTime(#authentication.principal.user.member_id)}"
                               class="w-[90%] p-3 border border-gray-300 rounded-lg text-base cursor-pointer">
                    </div>
                </div>
                <div class="text-right">
                    <button class="save-time-btn bg-[#9BDCFD] hover:bg-[#7fcdf8] px-6 py-2.5 rounded-lg text-white font-medium text-base cursor-pointer">
                        ì €ì¥
                    </button>
                </div>
            </div>
        </div>

        <!-- Stress ì„¹ì…˜ -->
        <div class="py-4 stress-section">
            <div class="flex justify-between items-center mb-5">


                <div class="text-2xl font-semibold mb-1">Stress</div>
                <button class="time-settings-btn p-1 rounded-full hover:bg-gray-100 cursor-pointer">âš™ï¸</button>
            </div>

            <div class="stress-no-data hidden text-gray-600 text-sm text-center p-4 overview-card">
                ì•„ì§ ê¸°ë¡ëœ í‡´ì‚¬ì§€ìˆ˜ê°€ ì—†ì–´ìš”
            </div>

            <div class="flex flex-row items-center gap-6 p-4 bg-[#f8f9fa] rounded-2xl">
                <div class="relative">
                    <svg width="200" height="200" class="transform -rotate-90">
                        <!-- í‡´ê·¼ê¹Œì§€ (ê°€ì¥ í° ì›) -->
                        <circle
                                cx="100"
                                cy="100"
                                r="90"
                                fill="none"
                                stroke="#C9F0FF"
                                stroke-width="15"
                        />
                        <circle
                                class="progress-circle transition-all duration-500 ease-in-out"
                                cx="100"
                                cy="100"
                                r="90"
                                fill="none"
                                stroke="#9BDCFD"
                                stroke-width="15"
                                stroke-dasharray="565.49"
                                stroke-dashoffset="565.49"
                                stroke-linecap="round"
                                data-progress="0"
                        />

                        <!-- ì ì‹¬ê¹Œì§€ (ê°€ì¥ ì‘ì€ ì›) -->
                        <circle
                                cx="100"
                                cy="100"
                                r="70"
                                fill="none"
                                stroke="#FFEFD7"
                                stroke-width="15"
                        />
                        <circle
                                class="progress-circle transition-all duration-500 ease-in-out"
                                cx="100"
                                cy="100"
                                r="70"
                                fill="none"
                                stroke="#FFD188"
                                stroke-width="15"
                                stroke-dasharray="439.82"
                                stroke-dashoffset="439.82"
                                stroke-linecap="round"
                                data-progress="0"
                        />
                    </svg>
                </div>
                <div class="relative bg-white rounded-xl p-5 shadow-sm w-full max-w-[280px]">
                    <div class="absolute -top-2 left-1/2 transform -translate-x-1/2 w-0 h-0 border-8 border-transparent border-b-white"></div>
                    <div class="text-center text-[#2C2C2C] leading-[1.8]">
                        <p class="text-base">
                            ì ì‹¬ì‹œê°„<span class="lunch-time time-value text-[#fbc159]"></span><br>
                            í‡´ê·¼ì‹œê°„<span class="end-time time-value text-[#00a3ed]"></span>
                        </p>
                    </div>
                    <div class="mt-3 text-center text-sm">
                        ë‚¨ì€ ì‹œê°„ë„ í˜ë‚´ì„¸ìš”! ğŸ’ª
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    // Spring Securityë¥¼ í†µí•´ ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
    const monthlyStressList = /*[[${@mainService.getMonthlyStress(
            #authentication.principal.user.member_id,
            T(java.time.LocalDate).now().format(T(java.time.format.DateTimeFormatter).ofPattern('yyyy-MM'))
        )}]]*/ [];

    const payday = /*[[${@mainService.getPayday(#authentication.principal.user.member_id)}]]*/ 15;
    const startTime = /*[[${@mainService.getStartTime(#authentication.principal.user.member_id)}]]*/ '09:00';
    const lunchTime = /*[[${@mainService.getLunchTime(#authentication.principal.user.member_id)}]]*/ '12:00';
    const endTime = /*[[${@mainService.getEndTime(#authentication.principal.user.member_id)}]]*/ '18:00';
</script>
<script th:src="@{/js/mainScript.js}"></script>

<style>
    @keyframes slide {
        0% { transform: translateY(100%); opacity: 0; }
        5%, 30% { transform: translateY(0); opacity: 1; }
        35% { transform: translateY(-100%); opacity: 0; }
        100% { transform: translateY(-100%); opacity: 0; }
    }
    .animate-slide {
        animation: slide 12s infinite;
    }
    .popular-content-bubble-item:nth-child(1) { animation-delay: 0s; }
    .popular-content-bubble-item:nth-child(2) { animation-delay: 4s; }
    .popular-content-bubble-item:nth-child(3) { animation-delay: 8s; }

    .calendar-date {
        font-size: 1.2rem;
        padding: 0.5rem 0;
        border-radius: 0.5rem;
        transition: all 0.2s ease;
    }

    .calendar-date.active {
        font-weight: bold;
    }

    /* ê°ì • ìƒíƒœ í´ë˜ìŠ¤ë“¤ */
    .verybad {
        background-color: #ff5353;
        color: white;
        font-weight: 500;
    }
    .bad {
        background-color: #ff9898;
        color: white;
        font-weight: 500;
    }
    .good {
        background-color: #9bdcfd;
        color: white;
        font-weight: 500;
    }
    .verygood {
        background-color: #00a3ed;
        color: white;
        font-weight: 500;
    }
</style>
</body>
</html>